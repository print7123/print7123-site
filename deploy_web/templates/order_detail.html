{% extends "base.html" %}

{% block title %}주문 상세 - 온누리인쇄나라{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <!-- 헤더 -->
            <div class="d-flex justify-content-between align-items-center mb-5">
                <div>
                    <h1 class="display-5 fw-bold text-primary">
                        <i class="fas fa-shopping-cart me-3"></i>주문 상세
                    </h1>
                    <p class="lead text-muted">주문번호: {{ order.order_number }}</p>
                </div>
                <div>
                    <a href="{{ url_for('my_orders') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>목록으로
                    </a>
                </div>
            </div>

            <!-- 주문 상태 진행바 -->
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-body p-4">
                    <h6 class="fw-bold mb-3">
                        <i class="fas fa-tasks me-2 text-primary"></i>주문 진행 상황
                    </h6>
                    <div class="progress mb-3" style="height: 8px;">
                        {% if order.status == '견적요청' %}
                            <div class="progress-bar bg-warning" style="width: 25%"></div>
                        {% elif order.status == '승인' %}
                            <div class="progress-bar bg-info" style="width: 50%"></div>
                        {% elif order.status == '제작중' %}
                            <div class="progress-bar bg-primary" style="width: 75%"></div>
                        {% elif order.status == '완료' %}
                            <div class="progress-bar bg-success" style="width: 100%"></div>
                        {% endif %}
                    </div>
                    
                    <div class="row text-center">
                        <div class="col">
                            <div class="{% if order.status == '견적요청' %}text-warning{% else %}text-muted{% endif %}">
                                <i class="fas fa-clock fa-2x mb-2"></i>
                                <p class="mb-0 small">견적요청</p>
                            </div>
                        </div>
                        <div class="col">
                            <div class="{% if order.status == '승인' %}text-info{% else %}text-muted{% endif %}">
                                <i class="fas fa-check fa-2x mb-2"></i>
                                <p class="mb-0 small">승인</p>
                            </div>
                        </div>
                        <div class="col">
                            <div class="{% if order.status == '제작중' %}text-primary{% else %}text-muted{% endif %}">
                                <i class="fas fa-cog fa-2x mb-2"></i>
                                <p class="mb-0 small">제작중</p>
                            </div>
                        </div>
                        <div class="col">
                            <div class="{% if order.status == '완료' %}text-success{% else %}text-muted{% endif %}">
                                <i class="fas fa-check-circle fa-2x mb-2"></i>
                                <p class="mb-0 small">완료</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- 주문 정보 -->
                <div class="col-lg-8">
                    <div class="card shadow-lg border-0 mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-info-circle me-2"></i>주문 정보
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="fw-bold mb-3">
                                        <i class="fas fa-print me-2 text-primary"></i>인쇄 정보
                                    </h6>
                                    <table class="table table-borderless">
                                        <tr>
                                            <td class="fw-bold">출력 타입:</td>
                                            <td>{{ order.print_type }}</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">제본 방식:</td>
                                            <td>{{ order.binding_type }}</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">수량:</td>
                                            <td>{{ order.quantity }}부</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">페이지:</td>
                                            <td>{{ order.pages }}p</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">용지 크기:</td>
                                            <td>{{ order.size }}</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="fw-bold mb-3">
                                        <i class="fas fa-money-bill me-2 text-success"></i>견적 정보
                                    </h6>
                                    <table class="table table-borderless">
                                        <tr>
                                            <td class="fw-bold">단가:</td>
                                            <td>₩{{ "{:,}".format(order.unit_price) }}</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">총 견적:</td>
                                            <td class="text-success fw-bold">₩{{ "{:,}".format(order.total_price) }}</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">주문 상태:</td>
                                            <td>
                                                {% if order.status == '견적요청' %}
                                                    <span class="badge bg-warning">견적요청</span>
                                                {% elif order.status == '승인' %}
                                                    <span class="badge bg-info">승인</span>
                                                {% elif order.status == '제작중' %}
                                                    <span class="badge bg-primary">제작중</span>
                                                {% elif order.status == '완료' %}
                                                    <span class="badge bg-success">완료</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">주문일:</td>
                                            <td>{{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">최종 업데이트:</td>
                                            <td>{{ order.updated_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            
                            {% if order.special_requirements %}
                            <div class="mt-4 p-3 bg-light rounded">
                                <h6 class="fw-bold mb-2">
                                    <i class="fas fa-comment me-2"></i>특별 요구사항
                                </h6>
                                <p class="mb-0">{{ order.special_requirements }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- 고객 정보 -->
                    <div class="card shadow-lg border-0 mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">
                                <i class="fas fa-user me-2"></i>고객 정보
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>고객명:</strong> {{ order.customer_name }}</p>
                                    <p><strong>연락처:</strong> {{ order.phone }}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>이메일:</strong> {{ order.email }}</p>
                                    <p><strong>주문자:</strong> {{ current_user.username }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 배송 정보 -->
                <div class="col-lg-4">
                    <div class="card shadow-lg border-0 mb-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-truck me-2"></i>배송 정보
                            </h5>
                        </div>
                        <div class="card-body">
                            {% if delivery %}
                                <div class="mb-3">
                                    <p class="mb-1"><strong>배송사:</strong> {{ delivery.delivery_company }}</p>
                                    <p class="mb-1"><strong>운송장번호:</strong> 
                                        {% if delivery.tracking_number %}
                                            <a href="#" onclick="trackDelivery('{{ delivery.tracking_number }}')" class="text-decoration-none">
                                                {{ delivery.tracking_number }}
                                            </a>
                                        {% else %}
                                            발급 대기중
                                        {% endif %}
                                    </p>
                                    <p class="mb-1"><strong>배송 상태:</strong> 
                                        <span class="badge bg-info">{{ delivery.delivery_status }}</span>
                                    </p>
                                    {% if delivery.delivery_date %}
                                    <p class="mb-0"><strong>배송일:</strong> {{ delivery.delivery_date.strftime('%Y-%m-%d') }}</p>
                                    {% endif %}
                                </div>
                                
                                {% if delivery.tracking_number %}
                                <button class="btn btn-outline-info btn-sm w-100" onclick="trackDelivery('{{ delivery.tracking_number }}')">
                                    <i class="fas fa-search me-2"></i>배송 추적
                                </button>
                                {% endif %}
                            {% else %}
                                <div class="text-center py-3">
                                    <i class="fas fa-truck fa-2x text-muted mb-2"></i>
                                    <p class="text-muted mb-0">배송 정보가 아직 등록되지 않았습니다.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- 파일 정보 -->
                    <div class="card shadow-lg border-0 mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">
                                <i class="fas fa-file me-2"></i>파일 정보
                            </h5>
                        </div>
                        <div class="card-body">
                            {% if order.file_path %}
                                <div class="text-center">
                                    <i class="fas fa-file-pdf fa-2x text-danger mb-2"></i>
                                    <p class="mb-2">파일이 업로드되었습니다.</p>
                                    <button class="btn btn-outline-primary btn-sm" onclick="downloadFile()">
                                        <i class="fas fa-download me-2"></i>파일 다운로드
                                    </button>
                                </div>
                            {% else %}
                                <div class="text-center py-3">
                                    <i class="fas fa-file fa-2x text-muted mb-2"></i>
                                    <p class="text-muted mb-0">업로드된 파일이 없습니다.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- 문의하기 -->
                    <div class="card shadow-lg border-0">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">
                                <i class="fas fa-headset me-2"></i>문의하기
                            </h5>
                        </div>
                        <div class="card-body">
                            <p class="small text-muted mb-3">주문에 대한 문의사항이 있으시면 언제든 연락주세요.</p>
                            <div class="d-grid gap-2">
                                <a href="{{ url_for('qa') }}" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-question-circle me-2"></i>Q&A 문의
                                </a>
                                <a href="tel:02-1234-5678" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-phone me-2"></i>전화 문의
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function trackDelivery(trackingNumber) {
    // 배송 추적 페이지로 이동 (실제 구현에서는 배송사 API 연동)
    alert(`배송 추적 번호: ${trackingNumber}\n\n실제 구현에서는 배송사 API를 연동하여 실시간 배송 정보를 제공합니다.`);
}

function downloadFile() {
    // 파일 다운로드 기능 (실제 구현에서는 서버에서 파일 제공)
    alert('파일 다운로드 기능은 실제 구현에서 서버에서 파일을 제공합니다.');
}
</script>
{% endblock %} 